--- ../src-base/minecraft/net/minecraft/block/BlockRedstoneComparator.java
+++ ../src-work/minecraft/net/minecraft/block/BlockRedstoneComparator.java
@@ -1,6 +1,7 @@
 package net.minecraft.block;
 
 import com.google.common.base.Predicate;
+
 import java.util.List;
 import java.util.Random;
 import javax.annotation.Nullable;
@@ -32,6 +33,9 @@
 import net.minecraft.util.text.translation.I18n;
 import net.minecraft.world.IBlockAccess;
 import net.minecraft.world.World;
+import carpet.CarpetSettings;
+import carpet.logging.LoggerRegistry;
+import carpet.logging.logHelpers.InstantComparators;
 
 public class BlockRedstoneComparator extends BlockRedstoneDiode implements ITileEntityProvider
 {
@@ -60,7 +64,7 @@
         return new ItemStack(Items.field_151132_bS);
     }
 
-    protected int func_176403_d(IBlockState p_176403_1_)
+    protected int getDelay(IBlockState state, World world, BlockPos pos)
     {
         return 2;
     }
@@ -101,7 +105,7 @@
     {
         int i = this.func_176397_f(p_176404_1_, p_176404_2_, p_176404_3_);
 
-        if (i >= 15)
+        if (i >= 15 && !CarpetSettings.ComparatorPowerFix)
         {
             return true;
         }
@@ -113,13 +117,24 @@
         {
             int j = this.func_176407_c(p_176404_1_, p_176404_2_, p_176404_3_);
 
-            if (j == 0)
+            if (!CarpetSettings.ComparatorPowerFix)
             {
+                if (j == 0)
+                {
+                    return true;
+                }
+                else
+                {
+                    return i >= j;
+                }
+            }
+            else if (i > j)
+            {
                 return true;
             }
             else
             {
-                return i >= j;
+                return i == j && p_176404_3_.func_177229_b(field_176463_b) == BlockRedstoneComparator.Mode.COMPARE;
             }
         }
     }
@@ -206,8 +221,32 @@
                 {
                     p_176398_1_.func_175654_a(p_176398_2_, this, 2, 0);
                 }
+                if (LoggerRegistry.__instantComparators)
+                {
+                    if (tileentity instanceof TileEntityComparator)
+                    {
+                        TileEntityComparator comparator = (TileEntityComparator) tileentity;
+                        int index = (int) Math.floorMod(p_176398_1_.func_82737_E() + 2, 3);
+                        comparator.scheduledOutputSignal[index] = i;
+                        comparator.buggy[index] = i == j;
+                    }
+                    else
+                    {
+                        InstantComparators.onNoTileEntity(p_176398_1_, p_176398_2_);
+                    }
+                }
             }
         }
+        else if (LoggerRegistry.__instantComparators)
+        {
+            TileEntity te = p_176398_1_.func_175625_s(p_176398_2_);
+            if (te instanceof TileEntityComparator)
+            {
+                TileEntityComparator comparator = (TileEntityComparator) te;
+                int index = (int) Math.floorMod(p_176398_1_.func_82737_E() + 2, 3);
+                comparator.scheduledOutputSignal[index] = func_176460_j(p_176398_1_, p_176398_2_, p_176398_3_);
+            }
+        }
     }
 
     private void func_176462_k(World p_176462_1_, BlockPos p_176462_2_, IBlockState p_176462_3_)
@@ -249,6 +288,22 @@
         }
 
         this.func_176462_k(p_180650_1_, p_180650_2_, p_180650_3_);
+
+        if (LoggerRegistry.__instantComparators)
+        {
+            TileEntity te = p_180650_1_.func_175625_s(p_180650_2_);
+            if (te instanceof TileEntityComparator)
+            {
+                TileEntityComparator comparator = (TileEntityComparator) te;
+                int index = (int) Math.floorMod(p_180650_1_.func_82737_E(), 3);
+                // output signal 0 is generally considered to just be a too fast pulse for a comparator, rather
+                // than an instant comparator
+                if (comparator.func_145996_a() != comparator.scheduledOutputSignal[index] && comparator.func_145996_a() != 0)
+                {
+                    InstantComparators.onInstantComparator(p_180650_1_, p_180650_2_, comparator.buggy[index]);
+                }
+            }
+        }
     }
 
     public void func_176213_c(World p_176213_1_, BlockPos p_176213_2_, IBlockState p_176213_3_)
